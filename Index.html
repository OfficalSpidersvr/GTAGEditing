<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Greenscreen Temple Hub</title>
  <meta name="description" content="Upload je greenscreen templates naar de map ‚Äòfiles‚Äô en deel ze direct met iedereen." />
  <style>
    :root {
      color-scheme: dark;
      --bg: #030712;
      --bg-soft: #050b1b;
      --panel: #08142d;
      --panel-soft: #0d1c3a;
      --border: rgba(59, 130, 246, 0.35);
      --glow: rgba(59, 130, 246, 0.25);
      --text: #e3edff;
      --muted: rgba(226, 232, 240, 0.7);
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.12);
      --radius-lg: 26px;
      --radius: 16px;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at 15% 10%, rgba(37, 99, 235, 0.18), transparent 55%),
        radial-gradient(circle at 85% 0%, rgba(14, 165, 233, 0.12), transparent 60%),
        var(--bg);
      min-height: 100vh;
      color: var(--text);
      display: flex;
      flex-direction: column;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: linear-gradient(180deg, rgba(3, 7, 18, 0.95), rgba(3, 7, 18, 0.75));
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(18px) saturate(130%);
    }

    .container {
      width: min(1100px, 92vw);
      margin: 0 auto;
      padding: 0 0 48px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 0;
      gap: 18px;
    }

    .logo {
      display: inline-flex;
      gap: 14px;
      align-items: center;
      font-size: 1.125rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .logo-badge {
      width: 44px;
      height: 44px;
      display: grid;
      place-items: center;
      background: linear-gradient(135deg, var(--accent), #1d4ed8);
      box-shadow: 0 0 0 6px rgba(59, 130, 246, 0.1), 0 18px 45px var(--glow);
      border-radius: 14px;
      font-weight: 800;
      color: #020617;
    }

    main {
      flex: 1;
    }

    .hero {
      padding: 46px 0 10px;
      display: grid;
      gap: 26px;
    }

    .hero-card {
      background: linear-gradient(160deg, rgba(30, 64, 175, 0.22), rgba(8, 12, 24, 0.4)), var(--panel);
      border: 1px solid var(--border);
      box-shadow: 0 30px 60px rgba(2, 6, 23, 0.7);
      border-radius: var(--radius-lg);
      padding: clamp(28px, 6vw, 40px);
      display: grid;
      gap: 18px;
    }

    h1 {
      margin: 0;
      font-size: clamp(2.2rem, 4.5vw, 3.2rem);
      line-height: 1.05;
    }

    p {
      margin: 0;
    }

    .muted {
      color: var(--muted);
    }

    .cta {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      background: var(--accent);
      color: #020617;
      font-weight: 600;
      padding: 12px 18px;
      border-radius: 14px;
      text-decoration: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 18px 34px rgba(59, 130, 246, 0.38);
    }

    .cta:hover {
      transform: translateY(-1px);
      box-shadow: 0 22px 45px rgba(59, 130, 246, 0.45);
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      align-items: center;
    }

    .search {
      flex: 1 1 260px;
      border-radius: 14px;
      border: 1px solid var(--border);
      padding: 14px 16px;
      background: rgba(15, 23, 42, 0.7);
      color: inherit;
      font: inherit;
      backdrop-filter: blur(16px);
    }

    .search::placeholder {
      color: rgba(226, 232, 240, 0.45);
    }

    .filter {
      display: inline-flex;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid transparent;
      background: rgba(15, 23, 42, 0.55);
      color: var(--muted);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .filter.active {
      color: var(--text);
      border-color: var(--accent);
      background: rgba(37, 99, 235, 0.18);
      box-shadow: 0 0 0 6px rgba(37, 99, 235, 0.1);
    }

    .status {
      margin-top: 18px;
      font-size: 0.95rem;
      color: var(--muted);
    }

    .grid {
      margin-top: 28px;
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    }

    .card {
      background: linear-gradient(180deg, var(--panel), var(--panel-soft));
      border-radius: var(--radius);
      border: 1px solid rgba(59, 130, 246, 0.2);
      box-shadow: 0 18px 38px rgba(2, 6, 23, 0.65);
      display: grid;
      padding: 20px;
      gap: 16px;
    }

    .card header {
      position: relative;
      background: none;
      border: none;
      padding: 0;
      backdrop-filter: none;
    }

    .card h3 {
      margin: 0;
      font-size: 1.1rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(37, 99, 235, 0.16);
      color: rgba(191, 219, 254, 0.95);
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-weight: 600;
    }

    video,
    audio {
      width: 100%;
      border-radius: calc(var(--radius) - 4px);
      border: 1px solid rgba(59, 130, 246, 0.25);
      background: rgba(15, 23, 42, 0.6);
    }

    .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 16px;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .download {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      align-self: flex-start;
      text-decoration: none;
      background: rgba(37, 99, 235, 0.18);
      border: 1px solid rgba(37, 99, 235, 0.5);
      color: var(--text);
      padding: 10px 16px;
      border-radius: 999px;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .download:hover {
      background: rgba(59, 130, 246, 0.28);
      box-shadow: 0 12px 24px rgba(59, 130, 246, 0.25);
    }

    footer {
      margin-top: 60px;
      padding: 36px 0 60px;
      color: rgba(148, 163, 184, 0.7);
      font-size: 0.9rem;
    }

    @media (max-width: 720px) {
      .container {
        padding-bottom: 32px;
      }

      .hero-card {
        padding: 24px;
      }

      .topbar {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container topbar">
      <div class="logo"><span class="logo-badge">GT</span> Greenscreen Temple Hub</div>
      <div class="muted" id="counter">0 bestanden</div>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="hero">
        <article class="hero-card">
          <h1>Deel je greenscreen tempels met de wereld</h1>
          <p class="muted">Sleep nieuwe MP4- of MP3-bestanden naar de map <strong>files/</strong> en ze verschijnen automatisch hier. Iedereen kan ze online bekijken of direct downloaden.</p>
          <a class="cta" href="files/" target="_blank" rel="noopener">üìÅ Open de map</a>
          <div class="controls">
            <input id="search" class="search" type="search" placeholder="Zoeken op naam‚Ä¶" aria-label="Zoeken" />
            <button class="filter active" data-filter="all" type="button">Alles</button>
            <button class="filter" data-filter="video" type="button">Alleen video</button>
            <button class="filter" data-filter="audio" type="button">Alleen audio</button>
          </div>
          <p class="status" id="status" role="status">Bezig met laden‚Ä¶</p>
        </article>
      </section>

      <section class="grid" id="grid" aria-live="polite"></section>

      <footer>
        Gemaakt voor snelle downloads van greenscreen templates. Voeg gewoon nieuwe bestanden toe en deel de link!
      </footer>
    </div>
  </main>

  <template id="card-template">
    <article class="card">
      <header>
        <span class="badge"></span>
        <h3></h3>
        <p class="muted"></p>
      </header>
      <div class="preview"></div>
      <div class="meta"></div>
      <a class="download" download>‚¨áÔ∏è Download</a>
    </article>
  </template>

  <script>
    const statusEl = document.getElementById('status');
    const grid = document.getElementById('grid');
    const tpl = document.getElementById('card-template');
    const filters = Array.from(document.querySelectorAll('.filter'));
    const searchInput = document.getElementById('search');
    const counter = document.getElementById('counter');

    let assets = [];
    let activeType = 'all';
    let query = '';

    function formatBytes(bytes) {
      if (!Number.isFinite(bytes) || bytes <= 0) return 'Onbekend formaat';
      const units = ['B', 'KB', 'MB', 'GB'];
      const power = Math.min(Math.floor(Math.log(bytes) / Math.log(1024)), units.length - 1);
      const size = bytes / Math.pow(1024, power);
      return `${size.toFixed(power === 0 ? 0 : 1)} ${units[power]}`;
    }

    function formatDate(value) {
      if (!value) return 'Onbekende datum';
      try {
        return new Intl.DateTimeFormat('nl-NL', {
          dateStyle: 'medium',
          timeStyle: 'short',
        }).format(new Date(value));
      } catch (e) {
        return value;
      }
    }

    function createCard(item) {
      const card = tpl.content.firstElementChild.cloneNode(true);
      card.dataset.type = item.kind;

      card.querySelector('.badge').textContent = item.kind === 'video' ? 'Video' : 'Audio';
      card.querySelector('h3').textContent = item.name;
      card.querySelector('p').textContent = item.description || '';

      const preview = card.querySelector('.preview');
      if (item.kind === 'video') {
        const video = document.createElement('video');
        video.controls = true;
        video.preload = 'metadata';
        video.src = item.url;
        video.playsInline = true;
        preview.append(video);
      } else {
        const audio = document.createElement('audio');
        audio.controls = true;
        audio.preload = 'metadata';
        audio.src = item.url;
        preview.append(audio);
      }

      const meta = card.querySelector('.meta');
      meta.innerHTML = `
        <span>Bestand: <strong>${item.extension.toUpperCase()}</strong></span>
        <span>Grootte: <strong>${formatBytes(item.size)}</strong></span>
        <span>Laatst gewijzigd: <strong>${formatDate(item.modified)}</strong></span>
      `;

      const download = card.querySelector('.download');
      download.href = item.url;
      download.download = item.name;
      download.setAttribute('aria-label', `Download ${item.name}`);

      return card;
    }

    function render() {
      const filtered = assets.filter((asset) => {
        const matchType = activeType === 'all' || asset.kind === activeType;
        const matchQuery = !query || asset.name.toLowerCase().includes(query);
        return matchType && matchQuery;
      });

      grid.innerHTML = '';

      if (!filtered.length) {
        const empty = document.createElement('p');
        empty.className = 'muted';
        empty.textContent = 'Geen bestanden gevonden. Voeg MP3 of MP4 toe aan de map files/.';
        grid.append(empty);
      } else {
        const frag = document.createDocumentFragment();
        filtered.forEach((item) => frag.append(createCard(item)));
        grid.append(frag);
      }

      const total = assets.length;
      counter.textContent = `${filtered.length} ${filtered.length === 1 ? 'bestand' : 'bestanden'}${
        filtered.length !== total ? ` van ${total}` : ''
      }`;

      if (statusEl && total) {
        const base = `${filtered.length} ${filtered.length === 1 ? 'bestand' : 'bestanden'}`;
        statusEl.textContent =
          activeType === 'all' && !query
            ? `Toont ${base}.`
            : `Toont ${base} (van ${total} totaal).`;
      }
    }

    function setStatus(message) {
      if (statusEl) statusEl.textContent = message;
    }

    function handleFilterClick(button) {
      filters.forEach((btn) => btn.classList.toggle('active', btn === button));
      activeType = button.dataset.filter;
      render();
    }

    filters.forEach((btn) => btn.addEventListener('click', () => handleFilterClick(btn)));

    searchInput.addEventListener('input', (event) => {
      query = event.target.value.trim().toLowerCase();
      render();
    });

    async function loadFiles() {
      try {
        const response = await fetch('api/files');
        if (!response.ok) {
          throw new Error(`Server antwoordde met ${response.status}`);
        }
        const data = await response.json();
        assets = data.map((item) => ({
          ...item,
          description: item.kind === 'video' ? 'Bekijk de video preview of download het bestand.' : 'Luister naar de audio preview of download het bestand.',
        }));
        assets.sort((a, b) => new Date(b.modified || 0) - new Date(a.modified || 0));
        setStatus(`${assets.length} ${assets.length === 1 ? 'bestand' : 'bestanden'} gevonden.`);
        render();
      } catch (error) {
        console.error(error);
        setStatus('Kon de bestanden niet laden. Controleer of de server draait.');
      }
    }

    loadFiles();
  </script>
</body>
</html>
